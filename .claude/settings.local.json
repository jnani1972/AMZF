{
  "permissions": {
    "allow": [
      "Bash(__NEW_LINE__ find . -name \"*.java\" -type f -exec sed -i '' )",
      "Bash({} ;)",
      "Bash(__NEW_LINE__ echo \"âœ… domain.broker imports updated\")",
      "Bash(__NEW_LINE__ echo \"âœ… domain.data imports updated\")",
      "Bash(__NEW_LINE__ echo \"âœ… domain.signal imports updated\")",
      "Bash(__NEW_LINE__ echo \"âœ… domain.trade imports updated\")",
      "Bash(__NEW_LINE__ echo \"âœ… domain.common imports updated\")",
      "Bash(mvn clean compile:*)",
      "Bash(find:*)",
      "Bash({} +)",
      "Bash(mvn test:*)",
      "Bash(git ls-tree:*)",
      "Bash(git add:*)",
      "Bash(cat:*)",
      "Bash(git rm:*)",
      "Bash(git push:*)",
      "Bash(git commit:*)",
      "Bash(git merge refactor/phase1-domain-layer --no-ff -m \"$\\(cat <<''EOF''\nMerge Phase 1: Domain Layer Migration to Clean Architecture\n\nSuccessfully merged the complete domain layer refactoring from flat\npackage structure to organized subdomains following DDD principles.\n\nKey Changes:\n- Organized 47 domain entities into 7 subdomains\n- Created domain.order with 5 new models for future broker abstraction\n- Updated 201+ import statements across entire codebase\n- Removed old domain.model and domain.enums packages\n- Cleaned up 276MB of old database backups\n- All 17 tests passing with zero failures\n\nDomain Structure:\nâœ“ domain.user: User, Portfolio, WsSession\nâœ“ domain.broker: Broker, UserBroker, UserBrokerSession, OAuth, enums\nâœ“ domain.data: Tick, Candle, Instrument, Watchlist entities\nâœ“ domain.signal: Signal, ExitSignal, MTF configs, enums\nâœ“ domain.trade: Trade, TradeIntent, ExitIntent, TradeEvent, enums\nâœ“ domain.order: OrderRequest, OrderResponse, OrderStatus, OrderType\nâœ“ domain.common: ValidationResult, EventType, EventScope\n\nThis sets the foundation for Phase 2 \\(Infrastructure layer refactoring\\).\n\nðŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(mvn compile:*)",
      "Bash(tee:*)",
      "Bash(mvn clean package:*)",
      "Bash(chmod:*)",
      "Bash(gh pr view:*)",
      "Bash(gh pr merge:*)",
      "Bash(git stash:*)",
      "Bash(git checkout:*)",
      "Bash(git pull:*)",
      "Bash(npm install:*)",
      "Bash(tree:*)",
      "Bash(npx tsc:*)",
      "Bash(ls:*)",
      "Bash(lsof:*)",
      "Bash(xargs kill -9)",
      "Bash(npx storybook@latest init:*)",
      "Bash(npm run build:*)",
      "Bash(curl:*)",
      "Bash(python3:*)",
      "Bash(TOKEN=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJVQURNSU4zN0EwIiwiZW1haWwiOiJhZG1pbkBhbm51cGFwZXIuY29tIiwicm9sZSI6IkFETUlOIiwiaWF0IjoxNzY4NDcwNTUzLCJleHAiOjE3Njg1NTY5NTN9.3t8aA6aaYp3Tq47ZUc1xS8dkJL7sc6BuvIdQ8FBaCc4\")",
      "Bash(done)",
      "Bash(grep:*)",
      "Bash(TOKEN=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJVQURNSU4zN0EwIiwiZW1haWwiOiJhZG1pbkBhbm51cGFwZXIuY29tIiwicm9sZSI6IkFETUlOIiwiaWF0IjoxNzY4NjM0MTAzLCJleHAiOjE3Njg3MjA1MDN9.qvJUd-SB6krjDUl447kmwKlz0LOIFF5s_1IW1ugc8MU\")",
      "Bash(__NEW_LINE__ echo \"=== Test 3: DELETE /api/admin/portfolios/P-UADMIN37A0 ===\")",
      "Bash(__NEW_LINE__ curl -v -X DELETE \"http://localhost:9090/api/admin/portfolios/P-UADMIN37A0\" )",
      "Bash(__NEW_LINE__ curl -X DELETE \"http://localhost:9090/api/admin/portfolios/P-UADMIN37A0\" )",
      "Bash(__NEW_LINE__ echo \"=== Test 4: PUT /api/admin/watchlist/84 ===\")",
      "Bash(__NEW_LINE__ curl -X PUT \"http://localhost:9090/api/admin/watchlist/84\" )",
      "Bash(src/main/java/in/annupaper/repository/WatchlistRepository.java )",
      "Bash(src/main/java/in/annupaper/repository/PostgresWatchlistRepository.java )",
      "Bash(src/main/java/in/annupaper/service/admin/AdminService.java )",
      "Bash(src/main/java/in/annupaper/transport/http/ApiHandlers.java)",
      "Bash(__NEW_LINE__ git status --short)",
      "Bash(__NEW_LINE__ git status)",
      "Bash(psql:*)",
      "Bash(wc:*)",
      "Bash(__NEW_LINE__ ain)",
      "Bash(echo \"=== Checking database configuration ===\" grep -r \"DB_USER\\\\|DB_PASSWORD\\\\|DB_URL\" .env*)",
      "Bash(env)",
      "Bash(if [ $? -ne 0 ])",
      "Bash(then)",
      "Bash(fi)",
      "Bash(sql/migrations/add_session_expiry_to_user_brokers.sql <<'SQL'\n-- Migration: Add session_expiry_at to user_brokers table\n-- Purpose: Enable monitoring of broker session expiry directly from user_brokers\n-- Date: 2026-01-18\n\n-- Add session_expiry_at column to user_brokers table\nALTER TABLE user_brokers \nADD COLUMN IF NOT EXISTS session_expiry_at TIMESTAMP WITH TIME ZONE;\n\n-- Create index for monitoring queries\nCREATE INDEX IF NOT EXISTS idx_user_brokers_session_expiry \nON user_brokers\\(session_expiry_at\\) \nWHERE deleted_at IS NULL AND enabled = true;\n\n-- Populate with data from user_broker_sessions \\(latest active session per user_broker\\)\nUPDATE user_brokers ub\nSET session_expiry_at = \\(\n    SELECT ubs.token_valid_till\n    FROM user_broker_sessions ubs\n    WHERE ubs.user_broker_id = ub.user_broker_id\n      AND ubs.deleted_at IS NULL\n      AND ubs.session_status = 'ACTIVE'\n    ORDER BY ubs.token_valid_till DESC\n    LIMIT 1\n\\)\nWHERE ub.deleted_at IS NULL;\n\n-- Verification query\nSELECT \n    COUNT\\(*\\) as total_brokers,\n    COUNT\\(session_expiry_at\\) as brokers_with_expiry,\n    COUNT\\(*\\) FILTER \\(WHERE session_expiry_at < NOW\\(\\)\\) as expired_sessions\nFROM user_brokers\nWHERE deleted_at IS NULL;\nSQL)"
    ]
  }
}
